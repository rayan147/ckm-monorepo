{"version":3,"file":"5-CS8m71e_.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(auth)/login/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/5.js"],"sourcesContent":["import { l as login, r as resendCode, v as verifyLoginCode } from \"../../../../chunks/auth.js\";\nimport { f as fail } from \"../../../../chunks/_layout.server.js\";\nimport { match, P } from \"ts-pattern\";\nconst actions = {\n  login: async ({ request, cookies }) => {\n    const data = await request.formData();\n    const email = data.get(\"email\")?.toString();\n    const password = data.get(\"password\")?.toString();\n    return match({ email, password }).with(\n      { email: P.nullish, password: P.nullish },\n      () => fail(400, {\n        step: 1,\n        message: \"Email and password are required\"\n      })\n    ).with(\n      { email: P.string.includes(\"@\"), password: P.string.length(10) },\n      () => fail(400, {\n        step: 1,\n        message: \"Needs to be a valid email or password needs to be 10 chars long\"\n      })\n    ).otherwise(async ({ email: email2, password: password2 }) => {\n      try {\n        const response = await login(email2, password2);\n        return match(response).with(\n          null,\n          () => fail(401, {\n            step: 1,\n            message: \"Invalid email or password\"\n          })\n        ).otherwise(() => {\n          cookies.set(\"email\", email2, {\n            httpOnly: true,\n            path: \"/\",\n            sameSite: \"strict\",\n            secure: process.env.NODE_ENV === \"production\",\n            maxAge: 60 * 60 * 24 * 7\n            // 1 week\n          });\n          return {\n            step: 2,\n            email: email2\n          };\n        });\n      } catch (error) {\n        console.error(error);\n        return fail(500, {\n          step: 1,\n          message: \"An error occurred. Please try again.\"\n        });\n      }\n    });\n  },\n  resendCode: async ({ request, cookies }) => {\n    const email = cookies.get(\"email\");\n    console.log({ email });\n    return match(email).with(P.string.includes(\"@\"), async (email2) => {\n      try {\n        await resendCode(email2);\n        return {\n          actionType: \"resendCode\",\n          type: \"success\",\n          message: \"Verification code has been resent to your email.\",\n          step: 2\n        };\n      } catch (error) {\n        console.error(error);\n        return fail(500, {\n          step: 2,\n          message: \"An error occurred while resending the code. Please try again.\"\n        });\n      }\n    }).with(\n      P.nullish,\n      () => fail(400, {\n        step: 2,\n        message: \"Email not found\"\n      })\n    ).otherwise(\n      () => fail(401, {\n        step: 2,\n        message: \"Not Authorized\"\n      })\n    );\n  },\n  verify: async ({ request, cookies }) => {\n    try {\n      const data = await request.formData();\n      const codeRaw = data.get(\"code\")?.toString();\n      return match(codeRaw).with(P.string.length(6), async (code) => {\n        const res = await verifyLoginCode(codeRaw);\n        console.log(res);\n        return match(res).with(\n          P.nullish,\n          () => fail(401, {\n            step: 2,\n            message: \"Invalid verification code\"\n          })\n        ).otherwise(({ user, accessToken }) => {\n          cookies.set(\"session\", accessToken, {\n            httpOnly: true,\n            path: \"/\",\n            sameSite: \"strict\",\n            secure: process.env.NODE_ENV === \"production\",\n            maxAge: 60 * 60 * 24 * 7\n            // 1 week\n          });\n          return {\n            actionType: \"verify\",\n            type: \"success\",\n            location: \"/dashboard\",\n            status: 200,\n            user\n          };\n        });\n      }).otherwise(\n        () => fail(400, {\n          step: 2,\n          message: \"Code cannot be null or invalid length\"\n        })\n      );\n    } catch (error) {\n      console.error(error);\n      const errorMessage = error.message;\n      return fail(500, {\n        step: 2,\n        message: `An error occurred: ${errorMessage}. Please try again.`\n      });\n    }\n  }\n};\nexport {\n  actions\n};\n","import * as server from '../entries/pages/(auth)/login/_page.server.ts.js';\n\nexport const index = 5;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(auth)/login/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(auth)/login/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/5.72nC1WMR.js\",\"_app/immutable/chunks/disclose-version.bJ1TNjgf.js\",\"_app/immutable/chunks/runtime.-IAcHVGa.js\",\"_app/immutable/chunks/template.2JA4nrVh.js\",\"_app/immutable/chunks/render.b8-zIhki.js\",\"_app/immutable/chunks/if.rhLWI7XC.js\",\"_app/immutable/chunks/forms.Wo3Zfvcr.js\",\"_app/immutable/chunks/entry.F0RumkfI.js\",\"_app/immutable/chunks/index.AeigFpnP.js\",\"_app/immutable/chunks/utils.VMsLsyhi.js\",\"_app/immutable/chunks/attributes.30sH_1mL.js\",\"_app/immutable/chunks/input.-wl6lriZ.js\",\"_app/immutable/chunks/proxy.-EQ_3oAC.js\",\"_app/immutable/chunks/legacy-client.JRc2EHbh.js\",\"_app/immutable/chunks/auth.uLbiO2Iw.js\",\"_app/immutable/chunks/RestaurantForm.5W2s5SDh.js\",\"_app/immutable/chunks/event-modifiers.159HUB1L.js\",\"_app/immutable/chunks/props.99304sWr.js\",\"_app/immutable/chunks/store.AHA2i8fh.js\",\"_app/immutable/chunks/index-client.CqCSz8ni.js\",\"_app/immutable/chunks/chef.ReSWN0ob.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}